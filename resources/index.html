<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Transfer for DGX Sparks</title>
  <link rel="stylesheet" href="/styles.css?v=13">
</head>

<body>

  <header id="header">
    <div class="header-top">
      <div class="logo">‚ö° File Transfer for DGX Sparks</div>
      <div class="flex-spacer"></div>
      <button class="btn-icon" id="btnTheme" title="Toggle light/dark theme" style="font-size:13px;border:none;background:none">‚òÄ</button>
      <select class="lang-select" id="langSelect">
        <option value="en">EN</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
      </select>
    </div>
    <div class="tab-bar">
      <button class="tab-btn active" id="tabFileTransfer" data-i18n="tab.fileTransfer">File Transfer</button>
      <button class="tab-btn" id="tabBackup" data-i18n="tab.backup">Backup &amp; Restore</button>
    </div>
    <div class="header-bottom" id="headerTransfer">
      <div class="server-bar">
        <div class="conn-dot" id="dotA"></div>
        <select class="server-select" id="selectA">
          <option value="" data-i18n="sel.serverSelect">-- Select server --</option>
        </select>
        <button class="btn-icon" id="btnEditA" data-i18n-title="header.editServer" title="Edit server" disabled>‚öô</button>
        <button class="btn-icon" id="btnAddServer" data-i18n-title="header.addServer" title="Add server">Ôºã</button>
      </div>
      <div class="transfer-center">
        <button class="btn-transfer" id="btnAtoB" data-i18n-title="header.transferAtoB" title="Transfer A ‚Üí B" disabled>‚Üí</button>
        <button class="btn-transfer" id="btnBtoA" data-i18n-title="header.transferBtoA" title="Transfer B ‚Üí A" disabled>‚Üê</button>
      </div>
      <div class="server-bar">
        <div class="conn-dot" id="dotB"></div>
        <select class="server-select" id="selectB">
          <option value="" data-i18n="sel.serverSelect">-- Select server --</option>
        </select>
        <button class="btn-icon" id="btnEditB" data-i18n-title="header.editServer" title="Edit server" disabled>‚öô</button>
        <div class="server-bar-right-pad"></div>
      </div>
    </div>
  </header>

  <!-- BACKUP TAB HEADER -->
  <div id="headerBackup" style="display:none" class="header-bottom">
    <div class="server-bar">
      <div class="conn-dot" id="dotBk"></div>
      <select class="server-select" id="selectBk">
        <option value="" data-i18n="sel.serverSelect">-- Select server --</option>
      </select>
      <button class="btn-icon" id="btnEditBk" data-i18n-title="header.editServer" title="Edit server" disabled>‚öô</button>
    </div>
    <div class="flex-spacer"></div>
    <div id="bkMountBar" class="bk-mount-bar" style="display:none">
      <div class="conn-dot" id="dotMount"></div>
      <span class="bk-mount-label" id="bkMountLabel">--</span>
      <span class="disk-info-inline" id="bkDiskInfo"></span>
      <button class="btn btn-sm btn-primary" id="btnMount" data-i18n="backup.mount">Mount</button>
      <button class="btn btn-sm btn-danger" id="btnUnmount" data-i18n="backup.unmount" style="display:none">Unmount</button>
    </div>
  </div>

  <main id="main">
    <div class="file-panel">
      <div class="panel-toolbar">
        <button class="btn-icon" id="btnUpA" data-i18n-title="panel.parentDir" title="Parent directory" disabled>‚Üë</button>
        <input type="text" class="path-input" id="pathA" data-i18n-placeholder="panel.pathPlaceholder" placeholder="Path...">
        <button class="btn-icon" id="btnDockerA" data-i18n-title="panel.dockerMode" title="Docker Images" disabled>üê≥</button>
        <button class="btn-icon btn-icon-danger" id="btnDeleteA" data-i18n-title="panel.delete" title="Delete selected" disabled>üóë</button>
        <button class="btn-icon" id="btnRefreshA" data-i18n-title="panel.refresh" title="Refresh" disabled>‚Üª</button>
      </div>
      <div class="disk-info-bar" id="diskInfoA"></div>
      <div class="list-header">
        <input type="checkbox" id="chkAllA" data-i18n-title="panel.selectAll" title="Select all">
        <span data-i18n="panel.name">Name</span><span data-i18n="panel.size">Size</span><span data-i18n="panel.modified">Modified</span>
      </div>
      <div class="list-body" id="listA">
        <div class="panel-state">
          <div class="state-icon">üñ•</div>
          <div class="state-msg" data-i18n="panel.selectServer">Select a server above</div>
        </div>
      </div>
    </div>
    <div class="file-panel">
      <div class="panel-toolbar">
        <button class="btn-icon" id="btnUpB" data-i18n-title="panel.parentDir" title="Parent directory" disabled>‚Üë</button>
        <input type="text" class="path-input" id="pathB" data-i18n-placeholder="panel.pathPlaceholder" placeholder="Path...">
        <button class="btn-icon" id="btnDockerB" data-i18n-title="panel.dockerMode" title="Docker Images" disabled>üê≥</button>
        <button class="btn-icon btn-icon-danger" id="btnDeleteB" data-i18n-title="panel.delete" title="Delete selected" disabled>üóë</button>
        <button class="btn-icon" id="btnRefreshB" data-i18n-title="panel.refresh" title="Refresh" disabled>‚Üª</button>
      </div>
      <div class="disk-info-bar" id="diskInfoB"></div>
      <div class="list-header">
        <input type="checkbox" id="chkAllB" data-i18n-title="panel.selectAll" title="Select all">
        <span data-i18n="panel.name">Name</span><span data-i18n="panel.size">Size</span><span data-i18n="panel.modified">Modified</span>
      </div>
      <div class="list-body" id="listB">
        <div class="panel-state">
          <div class="state-icon">üñ•</div>
          <div class="state-msg" data-i18n="panel.selectServer">Select a server above</div>
        </div>
      </div>
    </div>
  </main>

  <!-- BACKUP / RESTORE PANEL -->
  <div id="backupPanel" style="display:none" class="backup-panel">
    <!-- State: no server selected -->
    <div id="bkStateNoServer" class="panel-state">
      <div class="state-icon">üñ•</div>
      <div class="state-msg" data-i18n="backup.selectServer">Select a server to use backup &amp; restore</div>
    </div>
    <!-- State: no SSD config -->
    <div id="bkStateNoSsd" class="panel-state" style="display:none">
      <div class="state-icon">üíæ</div>
      <div class="state-msg" data-i18n="backup.noSsdConfig">No SSD configured for this server.</div>
    </div>
    <!-- Main backup content -->
    <div id="bkContent" style="display:none" class="bk-content">
      <!-- Sub-tabs -->
      <div class="bk-subtab-bar">
        <button class="bk-subtab active" id="bkTabDocker" data-i18n="backup.tabDocker">Docker Images</button>
        <button class="bk-subtab" id="bkTabHF" data-i18n="backup.tabHF">HF Models</button>
        <button class="bk-subtab" id="bkTabGGUF" data-i18n="backup.tabGGUF">GGUF</button>
      </div>
      <!-- Content area: left=server items, middle=SSD backups, right=log -->
      <div class="bk-body">
        <!-- Left: items on server (source for Backup) -->
        <div class="bk-list-pane">
          <div class="bk-list-toolbar">
            <span class="bk-pane-label" data-i18n="backup.sourcePanel">Server</span>
            <button class="btn btn-sm" id="btnBkLoad" data-i18n="backup.loadList">Load List</button>
            <div class="flex-spacer"></div>
            <button class="btn btn-sm btn-primary" id="btnBkBackup" data-i18n="backup.backupArrow" disabled>Backup ‚Üí</button>
            <button class="btn btn-sm btn-danger" id="btnBkCancel" data-i18n="backup.cancel" style="display:none">Cancel</button>
          </div>
          <div class="bk-list" id="bkList">
            <div class="panel-state">
              <div class="state-msg" style="color:var(--text3)" data-i18n="backup.selectItems">Select items to backup / restore</div>
            </div>
          </div>
        </div>
        <!-- Middle: items already backed up on SSD (source for Restore) -->
        <div class="bk-list-pane">
          <div class="bk-list-toolbar">
            <span class="bk-pane-label" data-i18n="backup.destPanel">SSD Backup</span>
            <button class="btn btn-sm" id="btnBkLoadBkup" data-i18n="backup.loadBackups">Load Backups</button>
            <div class="flex-spacer"></div>
            <button class="btn btn-sm" id="btnBkRestore" data-i18n="backup.restoreArrow" disabled>‚Üê Restore</button>
          </div>
          <div class="bk-list" id="bkBkupList">
            <div class="panel-state">
              <div class="state-msg" style="color:var(--text3)" data-i18n="backup.selectItems">Select items to backup / restore</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Resize handle -->
      <div class="bk-resize-handle" id="bkResizeHandle"></div>
      <!-- Bottom log (full width) -->
      <div class="bk-bottom-log" id="bkBottomLog">
        <div class="bk-log-toolbar">
          <span class="bk-pane-label">Log</span>
          <button class="btn btn-sm" id="btnBkToggleLog" style="padding:2px 6px;font-size:11px">‚ñº</button>
          <div class="flex-spacer"></div>
          <button class="btn btn-sm" id="btnBkClearLog" data-i18n="backup.clearLog">Clear</button>
        </div>
        <div class="bk-log" id="bkLog"></div>
      </div>
    </div>
  </div>

  <div id="progressSection">
    <div class="progress-meta">
      <div class="progress-title" id="progressTitle" data-i18n="progress.transferring">Transferring...</div>
      <div class="progress-stats">
        <span id="progressPct">0%</span>
        <span id="progressSpeed">-- B/s</span>
        <span id="progressEta">ETA: --</span>
        <button class="btn btn-danger" id="btnCancel" style="padding:3px 10px;font-size:11px;height:22px;" data-i18n="progress.cancel">Cancel</button>
      </div>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <div id="statusBar">
    <span class="status-text" id="statusText" data-i18n="status.ready">Ready</span>
    <span class="selection-info" id="selInfo"></span>
    <div class="zoom-controls">
      <button class="zoom-btn" id="btnZoomOut" title="Zoom out">‚àí</button>
      <span class="zoom-label" id="zoomLabel">100%</span>
      <button class="zoom-btn" id="btnZoomIn" title="Zoom in">Ôºã</button>
      <button class="zoom-btn" id="btnZoomReset" title="Reset zoom">‚Ü∫</button>
    </div>
  </div>

  <!-- SERVER MODAL -->
  <div class="modal-overlay" id="serverModal">
    <div class="modal-box">
      <div class="modal-title" id="modalTitle" data-i18n="modal.addServer">Add Server</div>

      <div class="form-group">
        <div class="form-label" data-i18n="modal.alias">Alias</div>
        <input type="text" class="form-input" id="fAlias" data-i18n-placeholder="modal.aliasPlaceholder" placeholder="e.g. DGX-Spark-A" autocomplete="off">
      </div>

      <div class="form-row">
        <div class="form-group">
          <div class="form-label" data-i18n="modal.sshHost">SSH Host (management network)</div>
          <input type="text" class="form-input" id="fSshHost" placeholder="192.168.0.10" autocomplete="off">
        </div>
        <div class="form-group">
          <div class="form-label" data-i18n="modal.port">Port</div>
          <input type="number" class="form-input" id="fPort" value="22" min="1" max="65535">
        </div>
      </div>

      <div class="form-group">
        <div class="form-label" data-i18n="modal.qsfpHost">QSFP Host (high-speed transfer)</div>
        <input type="text" class="form-input" id="fQsfpHost" placeholder="169.254.x.x" autocomplete="off">
        <div class="form-note" data-i18n="modal.qsfpNote">High-speed interface IP for file data ‚Äî nc (netcat) connects directly to this address, not SSH</div>
      </div>

      <div class="form-group">
        <label class="radio-label" style="gap:8px;cursor:pointer">
          <input type="checkbox" id="fUseSudo" style="accent-color:var(--accent);width:14px;height:14px;cursor:pointer">
          <span style="font-size:12px;color:var(--text)" data-i18n="modal.useSudo">Use sudo for transfers</span>
        </label>
        <div class="form-note" style="margin-top:4px" data-i18n-html="modal.sudoNote">
          When checked, tar commands run with <code style="color:var(--accent)">sudo</code>. Login password is used as sudo password.
        </div>
      </div>

      <div class="form-group">
        <div class="form-label" data-i18n="modal.username">Username</div>
        <input type="text" class="form-input" id="fUsername" placeholder="ubuntu" autocomplete="off">
      </div>

      <hr class="divider">

      <div class="form-group">
        <div class="form-label" data-i18n="modal.authType">Authentication</div>
        <div class="radio-group">
          <label class="radio-label"><input type="radio" name="authType" value="AGENT" checked> <span data-i18n="modal.authAgent">SSH Agent</span></label>
          <label class="radio-label"><input type="radio" name="authType" value="KEY"> <span data-i18n="modal.authKey">Private key (-i)</span></label>
          <label class="radio-label"><input type="radio" name="authType" value="PASSWORD"> <span data-i18n="modal.authPassword">Password</span></label>
          <label class="radio-label"><input type="radio" name="authType" value="CUSTOM"> <span data-i18n="modal.authCustom">Custom client</span></label>
        </div>
      </div>

      <div id="grpKey" style="display:none">
        <div class="form-group">
          <div class="form-label" data-i18n="modal.keyPath">Private key path</div>
          <input type="text" class="form-input" id="fKeyPath" data-i18n-placeholder="modal.keyPathPlaceholder" placeholder="C:\Users\user\.ssh\id_rsa" autocomplete="off">
        </div>
      </div>

      <div id="grpPassword" style="display:none">
        <div class="form-group">
          <div class="form-label" data-i18n="modal.clientPath">SSH client path</div>
          <input type="text" class="form-input" id="fClientPath" data-i18n-placeholder="modal.clientPathPlaceholder" placeholder=".\ssh-client.exe" autocomplete="off">
          <div class="form-note" data-i18n="modal.clientPathNote">Path to a client that supports password auth. Relative paths are based on app location.</div>
        </div>
        <div class="form-group" style="margin-top:8px">
          <div class="form-label" data-i18n="modal.password">Password</div>
          <input type="password" class="form-input" id="fCred" autocomplete="new-password">
        </div>
      </div>

      <div id="grpCustom" style="display:none">
        <div class="form-group">
          <div class="form-label" data-i18n="modal.cmdTemplate">Command template</div>
          <input type="text" class="form-input" id="fPrefix" data-i18n-placeholder="modal.cmdTemplatePlaceholder" placeholder=".\ssh-client.exe -l {USERNAME} -passwd {PASSWD} -p {PORT} {HOST} {CMD}" autocomplete="off">
          <div class="form-note" data-i18n-html="modal.templateNote">
            Available placeholders:<br>
            <code style="color:var(--accent)">{USERNAME}</code> username &nbsp;
            <code style="color:var(--accent)">{PASSWD}</code> password &nbsp;
            <code style="color:var(--accent)">{PORT}</code> port &nbsp;
            <code style="color:var(--accent)">{HOST}</code> SSH host &nbsp;
            <code style="color:var(--accent)">{CMD}</code> remote command<br>
            <code style="color:var(--text2)">.\ssh-client.exe -l {USERNAME} -passwd {PASSWD} -p {PORT} {HOST} {CMD}</code>
          </div>
        </div>
        <div class="form-group" style="margin-top:8px">
          <div class="form-label" data-i18n-html="modal.customPassword">Password <span style="color:var(--text3);font-weight:400">(optional ‚Äî when using {PASSWD})</span></div>
          <input type="password" class="form-input" id="fCredCustom" autocomplete="new-password">
        </div>
      </div>

      <hr class="divider">

      <div class="form-group">
        <div class="form-label" data-i18n="modal.ssdSection">External SSD &amp; Backup Settings</div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <div class="form-label" data-i18n="modal.ssdDevice">Device</div>
          <div style="display:flex;gap:5px">
            <input type="text" class="form-input" id="fSsdDevice" data-i18n-placeholder="modal.ssdDevicePlaceholder" placeholder="/dev/sda1" autocomplete="off">
            <button class="btn btn-sm" id="btnScanSsd" data-i18n="modal.ssdScan" style="flex-shrink:0">Scan</button>
          </div>
        </div>
        <div class="form-group">
          <div class="form-label" data-i18n="modal.ssdMountPoint">Mount Point</div>
          <input type="text" class="form-input" id="fSsdMount" data-i18n-placeholder="modal.ssdMountPlaceholder" placeholder="/mnt/ssd_t5" autocomplete="off">
        </div>
      </div>

      <div class="form-group">
        <div class="form-label" data-i18n="modal.hfHubPath">HF Hub Path</div>
        <input type="text" class="form-input" id="fHfHubPath" data-i18n-placeholder="modal.hfHubPathPlaceholder" placeholder="/home/ubuntu/.cache/huggingface/hub" autocomplete="off">
      </div>

      <div class="form-group">
        <div class="form-label" data-i18n="modal.ggufPath">GGUF Path</div>
        <input type="text" class="form-input" id="fGgufPath" data-i18n-placeholder="modal.ggufPathPlaceholder" placeholder="/home/ubuntu/gguf_models" autocomplete="off">
      </div>

      <div id="scanResult" style="display:none" class="scan-result"></div>

      <hr class="divider">

      <!-- TEST RESULT PANEL -->
      <div id="testResult"></div>

      <div class="modal-footer">
        <button class="btn" id="btnTestSSH" data-i18n-title="test.sshTestTitle" data-i18n="test.sshTest" title="Test SSH connection">SSH Test</button>
        <button class="btn" id="btnTestTools" data-i18n-title="test.toolsTestTitle" data-i18n="test.toolsTest" title="Check tar / pv / nc installation">Tools Test</button>
        <div class="flex-spacer"></div>
        <button class="btn btn-danger" id="btnDelServer" style="display:none" data-i18n="modal.delete">Delete</button>
        <button class="btn" id="btnModalCancel" data-i18n="modal.cancel">Cancel</button>
        <button class="btn btn-primary" id="btnModalSave" data-i18n="modal.save">Save</button>
      </div>
    </div>
  </div>

  <div id="toast"></div>

  <!-- neutralino.js must be loaded before all other scripts -->
  <script src="/js/neutralino.js"></script>
  <script src="/js/input-block.js?v=13"></script>
  <script src="/js/i18n.js?v=13"></script>
  <script src="/js/crypto.js?v=13"></script>
  <script src="/js/ssh.js?v=13"></script>
  <script src="/js/backup.js?v=13"></script>
  <script src="/js/zoom.js?v=13"></script>
  <script src="/js/main.js?v=13"></script>
</body>

</html>
